{
  "manifest_version": "1.3",
  "module": {
    "id": "workorders",
    "name": "Work Orders",
    "version": "1.0.0",
    "description": "Create, schedule, and track work orders from intake to completion.",
    "category": "Operations",
    "icon_key": "lucide:ClipboardList"
  },
  "app": {
    "home": "page:workorder.list_page",
    "defaults": {
      "entity_home_page": "page:workorder.list_page",
      "entity_form_page": "page:workorder.form_page",
      "entities": {
        "entity.workorder": {
          "entity_home_page": "page:workorder.list_page",
          "entity_form_page": "page:workorder.form_page"
        },
        "entity.workorder_line": {
          "entity_home_page": "page:workorder_line.list_page",
          "entity_form_page": "page:workorder_line.form_page"
        }
      }
    },
    "nav": [
      {
        "group": "Work Orders",
        "items": [
          {
            "label": "Work Orders",
            "to": "page:workorder.list_page"
          }
        ]
      }
    ]
  },
  "entities": [
    {
      "id": "entity.workorder",
      "display_field": "workorder.number",
      "fields": [
        {
          "id": "workorder.id",
          "type": "uuid",
          "label": "ID",
          "readonly": true
        },
        {
          "id": "workorder.number",
          "type": "string",
          "label": "Work Order #",
          "required": true,
          "help_text": "Unique job reference shown to customers and technicians."
        },
        {
          "id": "workorder.title",
          "type": "string",
          "label": "Title",
          "required": true
        },
        {
          "id": "workorder.status",
          "type": "enum",
          "label": "Status",
          "required": true,
          "default": "new",
          "options": [
            {
              "value": "new",
              "label": "New"
            },
            {
              "value": "scheduled",
              "label": "Scheduled"
            },
            {
              "value": "in_progress",
              "label": "In Progress"
            },
            {
              "value": "on_hold",
              "label": "On Hold"
            },
            {
              "value": "done",
              "label": "Done"
            },
            {
              "value": "cancelled",
              "label": "Cancelled"
            }
          ]
        },
        {
          "id": "workorder.priority",
          "type": "enum",
          "label": "Priority",
          "required": true,
          "default": "normal",
          "options": [
            {
              "value": "low",
              "label": "Low"
            },
            {
              "value": "normal",
              "label": "Normal"
            },
            {
              "value": "high",
              "label": "High"
            },
            {
              "value": "urgent",
              "label": "Urgent"
            }
          ]
        },
        {
          "id": "workorder.type",
          "type": "enum",
          "label": "Work Type",
          "required": true,
          "default": "installation",
          "options": [
            {
              "value": "installation",
              "label": "Installation"
            },
            {
              "value": "repair",
              "label": "Repair"
            },
            {
              "value": "maintenance",
              "label": "Maintenance"
            },
            {
              "value": "inspection",
              "label": "Inspection"
            }
          ]
        },
        {
          "id": "workorder.contact_id",
          "type": "lookup",
          "label": "Customer",
          "entity": "entity.contact",
          "display_field": "contact.display_name",
          "required": true,
          "help_text": "Primary customer contact from Contacts module."
        },
        {
          "id": "workorder.assignee_id",
          "type": "lookup",
          "label": "Assigned Technician",
          "entity": "entity.contact",
          "display_field": "contact.display_name",
          "help_text": "Technician responsible for execution."
        },
        {
          "id": "workorder.scheduled_start",
          "type": "datetime",
          "label": "Scheduled Start"
        },
        {
          "id": "workorder.scheduled_end",
          "type": "datetime",
          "label": "Scheduled End"
        },
        {
          "id": "workorder.completed_at",
          "type": "datetime",
          "label": "Completed At"
        },
        {
          "id": "workorder.site_name",
          "type": "string",
          "label": "Site Name"
        },
        {
          "id": "workorder.site_address",
          "type": "text",
          "label": "Site Address"
        },
        {
          "id": "workorder.city",
          "type": "string",
          "label": "City"
        },
        {
          "id": "workorder.country",
          "type": "string",
          "label": "Country"
        },
        {
          "id": "workorder.site_attachments",
          "type": "attachments",
          "label": "Site Photos",
          "help_text": "Upload photos for this site.",
          "ui": {
            "button_label": "Attach site photos",
            "title": "Site Photos",
            "description": "Upload photos and visual evidence."
          }
        },
        {
          "id": "workorder.site_drawings_attachments",
          "type": "attachments",
          "label": "Site Drawings",
          "help_text": "Upload plans, schematics, and technical drawings.",
          "ui": {
            "button_label": "Attach drawings",
            "title": "Site Drawings",
            "description": "PDFs, DWGs, and drawing exports."
          }
        },
        {
          "id": "workorder.site_compliance_attachments",
          "type": "attachments",
          "label": "Site Compliance Docs",
          "help_text": "Upload permits, certificates, and compliance paperwork.",
          "ui": {
            "button_label": "Attach compliance docs",
            "title": "Compliance Documents",
            "description": "Certificates, permits, and compliance records."
          }
        },
        {
          "id": "workorder.labor_hours",
          "type": "number",
          "label": "Labor Hours",
          "default": 0
        },
        {
          "id": "workorder.materials_cost",
          "type": "number",
          "label": "Materials Cost",
          "default": 0
        },
        {
          "id": "workorder.total_cost",
          "type": "number",
          "label": "Total Cost",
          "help_text": "For demo: enter total manually."
        },
        {
          "id": "workorder.description",
          "type": "text",
          "label": "Scope of Work"
        },
        {
          "id": "workorder.internal_notes",
          "type": "text",
          "label": "Internal Notes"
        },
        {
          "id": "workorder.on_hold_reason",
          "type": "text",
          "label": "On Hold Reason"
        },
        {
          "id": "workorder.cancel_reason",
          "type": "text",
          "label": "Cancel Reason"
        },
        {
          "id": "workorder.tags",
          "type": "tags",
          "label": "Tags",
          "help_text": "For quick filtering and analytics."
        }
      ]
    },
    {
      "id": "entity.workorder_line",
      "display_field": "workorder_line.description",
      "fields": [
        {
          "id": "workorder_line.id",
          "type": "uuid",
          "label": "ID",
          "readonly": true
        },
        {
          "id": "workorder_line.workorder_id",
          "type": "lookup",
          "label": "Work Order",
          "entity": "entity.workorder",
          "display_field": "workorder.number",
          "required": true,
          "help_text": "Parent work order record."
        },
        {
          "id": "workorder_line.item_id",
          "type": "lookup",
          "label": "Item",
          "entity": "entity.item",
          "display_field": "item.name",
          "required": true,
          "help_text": "Catalog item from Items & Pricing module."
        },
        {
          "id": "workorder_line.description",
          "type": "string",
          "label": "Description",
          "required": true
        },
        {
          "id": "workorder_line.qty",
          "type": "number",
          "label": "Qty",
          "required": true,
          "default": 1
        },
        {
          "id": "workorder_line.unit_price",
          "type": "number",
          "label": "Unit Price",
          "required": true,
          "default": 0
        },
        {
          "id": "workorder_line.discount_pct",
          "type": "number",
          "label": "Discount %",
          "default": 0
        },
        {
          "id": "workorder_line.tax_rate",
          "type": "number",
          "label": "Tax %",
          "default": 0
        },
        {
          "id": "workorder_line.line_total",
          "type": "number",
          "label": "Line Total",
          "help_text": "For demo: enter line total manually (qty x unit price less discount plus tax)."
        },
        {
          "id": "workorder_line.notes",
          "type": "text",
          "label": "Line Notes"
        }
      ]
    }
  ],
  "relations": [
    {
      "from": "workorder.contact_id",
      "to": "contact.id",
      "label_field": "contact.display_name"
    },
    {
      "from": "workorder.assignee_id",
      "to": "contact.id",
      "label_field": "contact.display_name"
    },
    {
      "from": "workorder_line.workorder_id",
      "to": "workorder.id",
      "label_field": "workorder.number"
    },
    {
      "from": "workorder_line.item_id",
      "to": "item.id",
      "label_field": "item.name"
    }
  ],
  "workflows": [
    {
      "id": "workorder_status_workflow",
      "entity": "entity.workorder",
      "status_field": "workorder.status",
      "states": [
        {
          "id": "new",
          "label": "New"
        },
        {
          "id": "scheduled",
          "label": "Scheduled"
        },
        {
          "id": "in_progress",
          "label": "In Progress"
        },
        {
          "id": "on_hold",
          "label": "On Hold"
        },
        {
          "id": "done",
          "label": "Done"
        },
        {
          "id": "cancelled",
          "label": "Cancelled"
        }
      ]
    }
  ],
  "actions": [
    {
      "id": "action.refresh",
      "kind": "refresh",
      "label": "Refresh"
    },
    {
      "id": "action.workorder_new",
      "kind": "open_form",
      "target": "workorder.form",
      "label": "New"
    },
    {
      "id": "action.workorder_set_new",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: New",
      "patch": {
        "workorder.status": "new"
      }
    },
    {
      "id": "action.workorder_bulk_set_new",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: New",
      "patch": {
        "workorder.status": "new"
      }
    },
    {
      "id": "action.workorder_set_scheduled",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: Scheduled",
      "patch": {
        "workorder.status": "scheduled"
      }
    },
    {
      "id": "action.workorder_bulk_set_scheduled",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: Scheduled",
      "patch": {
        "workorder.status": "scheduled"
      }
    },
    {
      "id": "action.workorder_set_in_progress",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: In Progress",
      "patch": {
        "workorder.status": "in_progress"
      }
    },
    {
      "id": "action.workorder_bulk_set_in_progress",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: In Progress",
      "patch": {
        "workorder.status": "in_progress"
      }
    },
    {
      "id": "action.workorder_set_on_hold",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: On Hold",
      "patch": {
        "workorder.status": "on_hold"
      }
    },
    {
      "id": "action.workorder_bulk_set_on_hold",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: On Hold",
      "patch": {
        "workorder.status": "on_hold"
      }
    },
    {
      "id": "action.workorder_set_done",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: Done",
      "patch": {
        "workorder.status": "done"
      }
    },
    {
      "id": "action.workorder_bulk_set_done",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: Done",
      "patch": {
        "workorder.status": "done"
      }
    },
    {
      "id": "action.workorder_set_cancelled",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: Cancelled",
      "patch": {
        "workorder.status": "cancelled"
      }
    },
    {
      "id": "action.workorder_bulk_set_cancelled",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: Cancelled",
      "patch": {
        "workorder.status": "cancelled"
      }
    },
    {
      "id": "action.mark_scheduled",
      "kind": "update_record",
      "label": "Schedule",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "scheduled"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "new"
      }
    },
    {
      "id": "action.start_work",
      "kind": "update_record",
      "label": "Start Work",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "in_progress"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "scheduled"
      }
    },
    {
      "id": "action.put_on_hold",
      "kind": "refresh",
      "label": "Put On Hold",
      "modal_id": "modal.workorder_on_hold_reason",
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "in_progress"
      }
    },
    {
      "id": "action.put_on_hold_confirm",
      "kind": "update_record",
      "label": "Confirm Hold",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "on_hold",
        "workorder.on_hold_reason": {
          "ref": "$record.workorder.on_hold_reason"
        }
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "in_progress"
      }
    },
    {
      "id": "action.put_on_hold_decline",
      "kind": "refresh",
      "label": "Decline"
    },
    {
      "id": "action.cancel_work",
      "kind": "refresh",
      "label": "Cancel Work",
      "modal_id": "modal.workorder_cancel_reason",
      "visible_when": {
        "op": "or",
        "conditions": [
          {
            "op": "eq",
            "field": "workorder.status",
            "value": "new"
          },
          {
            "op": "eq",
            "field": "workorder.status",
            "value": "scheduled"
          },
          {
            "op": "eq",
            "field": "workorder.status",
            "value": "in_progress"
          },
          {
            "op": "eq",
            "field": "workorder.status",
            "value": "on_hold"
          }
        ]
      }
    },
    {
      "id": "action.cancel_work_confirm",
      "kind": "update_record",
      "label": "Confirm Cancel",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "cancelled",
        "workorder.cancel_reason": {
          "ref": "$record.workorder.cancel_reason"
        }
      }
    },
    {
      "id": "action.cancel_work_decline",
      "kind": "refresh",
      "label": "Decline Cancel"
    },
    {
      "id": "action.resume_work",
      "kind": "update_record",
      "label": "Resume Work",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "in_progress"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "on_hold"
      }
    },
    {
      "id": "action.complete_work",
      "kind": "update_record",
      "label": "Complete",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "done"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "in_progress"
      }
    },
    {
      "id": "action.reopen_work",
      "kind": "update_record",
      "label": "Reopen",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "in_progress"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "done"
      }
    },
    {
      "id": "action.email_workorder",
      "kind": "refresh",
      "label": "Email Work Order",
      "visible_when": {
        "op": "exists",
        "field": "workorder.number"
      }
    },
    {
      "id": "action.generate_workorder_pdf",
      "kind": "refresh",
      "label": "Generate PDF",
      "visible_when": {
        "op": "exists",
        "field": "workorder.number"
      }
    },
    {
      "id": "action.workorder_line_new",
      "kind": "open_form",
      "target": "workorder_line.form",
      "label": "Add Line"
    },
    {
      "id": "action.workorder_line_new_for_workorder",
      "kind": "create_record",
      "entity_id": "entity.workorder_line",
      "label": "Add Line",
      "defaults": {
        "workorder_line.workorder_id": {
          "ref": "$record.id"
        },
        "workorder_line.description": "New line item",
        "workorder_line.qty": 1,
        "workorder_line.unit_price": 0,
        "workorder_line.tax_rate": 0,
        "workorder_line.discount_pct": 0
      },
      "visible_when": {
        "op": "exists",
        "field": "workorder.number"
      }
    }
  ],
  "modals": [
    {
      "id": "modal.workorder_on_hold_reason",
      "title": "Put Work Order On Hold",
      "description": "Add a reason before moving this work order to On Hold.",
      "entity_id": "entity.workorder",
      "fields": [
        "workorder.on_hold_reason"
      ],
      "actions": [
        {
          "action_id": "action.put_on_hold_decline",
          "label": "Decline",
          "variant": "soft",
          "close_on_success": true
        },
        {
          "action_id": "action.put_on_hold_confirm",
          "label": "Confirm Hold",
          "variant": "primary",
          "close_on_success": true
        }
      ]
    },
    {
      "id": "modal.workorder_cancel_reason",
      "title": "Cancel Work Order",
      "description": "Add a reason before cancelling this work order.",
      "entity_id": "entity.workorder",
      "fields": [
        "workorder.cancel_reason"
      ],
      "actions": [
        {
          "action_id": "action.cancel_work_decline",
          "label": "Decline",
          "variant": "soft",
          "close_on_success": true
        },
        {
          "action_id": "action.cancel_work_confirm",
          "label": "Confirm Cancel",
          "variant": "primary",
          "close_on_success": true
        }
      ]
    }
  ],
  "triggers": [
    {
      "id": "workorders.record.created",
      "event": "record.created",
      "entity_id": "entity.workorder"
    },
    {
      "id": "workorders.record.updated",
      "event": "record.updated",
      "entity_id": "entity.workorder"
    },
    {
      "id": "workorders.action.mark_scheduled",
      "event": "action.clicked",
      "action_id": "action.mark_scheduled"
    },
    {
      "id": "workorders.action.start_work",
      "event": "action.clicked",
      "action_id": "action.start_work"
    },
    {
      "id": "workorders.action.put_on_hold",
      "event": "action.clicked",
      "action_id": "action.put_on_hold"
    },
    {
      "id": "workorders.action.put_on_hold_confirm",
      "event": "action.clicked",
      "action_id": "action.put_on_hold_confirm"
    },
    {
      "id": "workorders.action.cancel_work",
      "event": "action.clicked",
      "action_id": "action.cancel_work"
    },
    {
      "id": "workorders.action.cancel_work_confirm",
      "event": "action.clicked",
      "action_id": "action.cancel_work_confirm"
    },
    {
      "id": "workorders.action.resume_work",
      "event": "action.clicked",
      "action_id": "action.resume_work"
    },
    {
      "id": "workorders.action.complete_work",
      "event": "action.clicked",
      "action_id": "action.complete_work"
    },
    {
      "id": "workorders.action.reopen_work",
      "event": "action.clicked",
      "action_id": "action.reopen_work"
    },
    {
      "id": "workorders.action.email_workorder",
      "event": "action.clicked",
      "action_id": "action.email_workorder"
    },
    {
      "id": "workorders.action.generate_workorder_pdf",
      "event": "action.clicked",
      "action_id": "action.generate_workorder_pdf"
    },
    {
      "id": "workorders.workflow.status_changed",
      "event": "workflow.status_changed",
      "entity_id": "entity.workorder",
      "status_field": "workorder.status"
    },
    {
      "id": "workorders.action.workorder_line_new_for_workorder",
      "event": "action.clicked",
      "action_id": "action.workorder_line_new_for_workorder"
    }
  ],
  "views": [
    {
      "id": "workorder.list",
      "entity": "entity.workorder",
      "kind": "list",
      "columns": [
        {
          "field_id": "workorder.number"
        },
        {
          "field_id": "workorder.title"
        },
        {
          "field_id": "workorder.status"
        },
        {
          "field_id": "workorder.priority"
        },
        {
          "field_id": "workorder.type"
        },
        {
          "field_id": "workorder.contact_id"
        },
        {
          "field_id": "workorder.assignee_id"
        },
        {
          "field_id": "workorder.scheduled_start"
        },
        {
          "field_id": "workorder.total_cost"
        }
      ],
      "open_record": {
        "to": "page:workorder.form_page",
        "param": "record"
      },
      "header": {
        "primary_actions": [
          {
            "action_id": "action.workorder_new"
          }
        ],
        "search": {
          "enabled": true,
          "placeholder": "Search work orders...",
          "fields": [
            "workorder.number",
            "workorder.title",
            "workorder.status",
            "workorder.priority",
            "workorder.type",
            "workorder.site_name",
            "workorder.city",
            "workorder.country"
          ]
        },
        "filters": [
          {
            "id": "all",
            "label": "All",
            "domain": {
              "op": "exists",
              "field": "workorder.number"
            }
          },
          {
            "id": "new",
            "label": "New",
            "domain": {
              "op": "eq",
              "field": "workorder.status",
              "value": "new"
            }
          },
          {
            "id": "in_progress",
            "label": "In Progress",
            "domain": {
              "op": "eq",
              "field": "workorder.status",
              "value": "in_progress"
            }
          },
          {
            "id": "done",
            "label": "Done",
            "domain": {
              "op": "eq",
              "field": "workorder.status",
              "value": "done"
            }
          }
        ]
      },
      "create_behavior": "open_form"
    },
    {
      "id": "workorder.kanban",
      "kind": "kanban",
      "entity": "entity.workorder",
      "card": {
        "title_field": "workorder.number",
        "subtitle_fields": [
          "workorder.title",
          "workorder.contact_id"
        ],
        "badge_fields": [
          "workorder.priority",
          "workorder.status",
          "workorder.tags"
        ]
      }
    },
    {
      "id": "workorder.graph",
      "kind": "graph",
      "entity": "entity.workorder",
      "default": {
        "type": "bar",
        "group_by": "workorder.status",
        "measure": "count"
      }
    },
    {
      "id": "workorder.calendar",
      "kind": "calendar",
      "entity": "entity.workorder",
      "calendar": {
        "title_field": "workorder.title",
        "date_start": "workorder.scheduled_start",
        "date_end": "workorder.scheduled_end",
        "color_field": "workorder.assignee_id",
        "default_scale": "month"
      }
    },
    {
      "id": "workorder.form",
      "entity": "entity.workorder",
      "kind": "form",
      "sections": [
        {
          "id": "main",
          "layout": "columns",
          "columns": 2,
          "fields": [
            "workorder.number",
            "workorder.title",
            "workorder.status",
            "workorder.priority",
            "workorder.type",
            "workorder.contact_id",
            "workorder.assignee_id",
            "workorder.scheduled_start",
            "workorder.scheduled_end",
            "workorder.completed_at",
            "workorder.tags"
          ]
        },
        {
          "id": "site",
          "layout": "columns",
          "columns": 2,
          "fields": [
            "workorder.site_name",
            "workorder.site_address",
            "workorder.city",
            "workorder.country",
            "workorder.site_attachments",
            "workorder.site_drawings_attachments",
            "workorder.site_compliance_attachments"
          ]
        },
        {
          "id": "costs",
          "layout": "columns",
          "columns": 2,
          "fields": [
            "workorder.labor_hours",
            "workorder.materials_cost",
            "workorder.total_cost"
          ]
        },
        {
          "id": "scope",
          "fields": [
            "workorder.description"
          ]
        },
        {
          "id": "notes",
          "fields": [
            "workorder.internal_notes",
            "workorder.on_hold_reason",
            "workorder.cancel_reason"
          ]
        },
        {
          "id": "line_items",
          "title": "Line Items",
          "line_editor": {
            "entity_id": "entity.workorder_line",
            "parent_field": "workorder_line.workorder_id",
            "item_lookup_field": "workorder_line.item_id",
            "item_lookup_entity": "entity.item",
            "item_lookup_display_field": "item.name",
            "item_field_map": {
              "workorder_line.unit_price": "item.unit_price",
              "workorder_line.tax_rate": "item.tax_rate",
              "workorder_line.description": "item.description"
            },
            "description_field": "workorder_line.description",
            "defaults": {
              "workorder_line.qty": 1,
              "workorder_line.unit_price": 0,
              "workorder_line.tax_rate": 0,
              "workorder_line.discount_pct": 0
            },
            "columns": [
              {
                "field_id": "workorder_line.item_id",
                "label": "Item",
                "readonly": true
              },
              {
                "field_id": "workorder_line.description",
                "label": "Description"
              },
              {
                "field_id": "workorder_line.qty",
                "label": "Qty",
                "type": "number"
              },
              {
                "field_id": "workorder_line.unit_price",
                "label": "Unit Price",
                "type": "number"
              },
              {
                "field_id": "workorder_line.discount_pct",
                "label": "Discount %",
                "type": "number"
              },
              {
                "field_id": "workorder_line.tax_rate",
                "label": "Tax %",
                "type": "number"
              },
              {
                "field_id": "workorder_line.line_total",
                "label": "Line Total",
                "type": "number"
              }
            ]
          }
        }
      ],
      "header": {
        "title_field": "workorder.number",
        "primary_actions": [
          {
            "action_id": "action.mark_scheduled"
          },
          {
            "action_id": "action.start_work"
          },
          {
            "action_id": "action.put_on_hold"
          },
          {
            "action_id": "action.cancel_work"
          },
          {
            "action_id": "action.resume_work"
          },
          {
            "action_id": "action.complete_work"
          },
          {
            "action_id": "action.reopen_work"
          },
          {
            "action_id": "action.email_workorder"
          },
          {
            "action_id": "action.generate_workorder_pdf"
          }
        ],
        "secondary_actions": [
          {
            "action_id": "action.refresh"
          }
        ],
        "save_mode": "top",
        "auto_save": true,
        "auto_save_debounce_ms": 750,
        "statusbar": {
          "field_id": "workorder.status"
        },
        "tabs": {
          "style": "lifted",
          "default_tab": "details",
          "tabs": [
            {
              "id": "details",
              "label": "Details",
              "sections": [
                "main"
              ]
            },
            {
              "id": "site",
              "label": "Site",
              "sections": [
                "site"
              ]
            },
            {
              "id": "costs",
              "label": "Costs",
              "sections": [
                "costs"
              ]
            },
            {
              "id": "scope",
              "label": "Scope",
              "sections": [
                "scope"
              ]
            },
            {
              "id": "notes",
              "label": "Notes",
              "sections": [
                "notes"
              ]
            },
            {
              "id": "line_items",
              "label": "Line Items",
              "sections": [
                "line_items"
              ]
            }
          ]
        }
      },
      "line_editors": {
        "line_items": {
          "entity_id": "entity.workorder_line",
          "parent_field": "workorder_line.workorder_id",
          "item_lookup_field": "workorder_line.item_id",
          "item_lookup_entity": "entity.item",
          "item_lookup_display_field": "item.name",
          "item_field_map": {
            "workorder_line.unit_price": "item.unit_price",
            "workorder_line.tax_rate": "item.tax_rate",
            "workorder_line.description": "item.description"
          },
          "description_field": "workorder_line.description",
          "defaults": {
            "workorder_line.qty": 1,
            "workorder_line.unit_price": 0,
            "workorder_line.tax_rate": 0,
            "workorder_line.discount_pct": 0
          },
          "columns": [
            {
              "field_id": "workorder_line.item_id",
              "label": "Item",
              "readonly": true
            },
            {
              "field_id": "workorder_line.description",
              "label": "Description"
            },
            {
              "field_id": "workorder_line.qty",
              "label": "Qty",
              "type": "number"
            },
            {
              "field_id": "workorder_line.unit_price",
              "label": "Unit Price",
              "type": "number"
            },
            {
              "field_id": "workorder_line.discount_pct",
              "label": "Discount %",
              "type": "number"
            },
            {
              "field_id": "workorder_line.tax_rate",
              "label": "Tax %",
              "type": "number"
            },
            {
              "field_id": "workorder_line.line_total",
              "label": "Line Total",
              "type": "number"
            }
          ]
        }
      }
    },
    {
      "id": "workorder_line.form",
      "entity": "entity.workorder_line",
      "kind": "form",
      "sections": [
        {
          "id": "main",
          "layout": "columns",
          "columns": 2,
          "fields": [
            "workorder_line.workorder_id",
            "workorder_line.item_id",
            "workorder_line.description",
            "workorder_line.qty",
            "workorder_line.unit_price",
            "workorder_line.discount_pct",
            "workorder_line.tax_rate",
            "workorder_line.line_total"
          ]
        },
        {
          "id": "notes",
          "fields": [
            "workorder_line.notes"
          ]
        }
      ],
      "header": {
        "title_field": "workorder_line.description",
        "save_mode": "top",
        "auto_save": true,
        "auto_save_debounce_ms": 750,
        "secondary_actions": [
          {
            "action_id": "action.refresh"
          }
        ]
      }
    },
    {
      "id": "workorder_line.list",
      "entity": "entity.workorder_line",
      "kind": "list",
      "columns": [
        {
          "field_id": "workorder_line.item_id"
        },
        {
          "field_id": "workorder_line.description"
        },
        {
          "field_id": "workorder_line.qty"
        },
        {
          "field_id": "workorder_line.unit_price"
        },
        {
          "field_id": "workorder_line.discount_pct"
        },
        {
          "field_id": "workorder_line.tax_rate"
        },
        {
          "field_id": "workorder_line.line_total"
        }
      ],
      "open_record": {
        "to": "page:workorder_line.form_page",
        "param": "record"
      },
      "header": {
        "primary_actions": [
          {
            "action_id": "action.workorder_line_new"
          }
        ],
        "search": {
          "enabled": true,
          "placeholder": "Search line items...",
          "fields": [
            "workorder_line.description"
          ]
        }
      }
    }
  ],
  "pages": [
    {
      "id": "workorder.list_page",
      "title": "Work Orders",
      "layout": "single",
      "header": {
        "variant": "none",
        "actions": [
          {
            "action_id": "action.refresh"
          },
          {
            "kind": "navigate",
            "label": "New",
            "target": "page:workorder.form_page"
          }
        ]
      },
      "content": [
        {
          "kind": "container",
          "variant": "card",
          "content": [
            {
              "kind": "view_modes",
              "entity_id": "entity.workorder",
              "default_mode": "list",
              "modes": [
                {
                  "mode": "list",
                  "target": "view:workorder.list"
                },
                {
                  "mode": "kanban",
                  "target": "view:workorder.kanban",
                  "default_group_by": "workorder.status"
                },
                {
                  "mode": "graph",
                  "target": "view:workorder.graph"
                },
                {
                  "mode": "calendar",
                  "target": "view:workorder.calendar"
                },
                {
                  "mode": "pivot",
                  "target": "view:workorder.graph"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "workorder.form_page",
      "title": "Work Order",
      "layout": "single",
      "header": {
        "variant": "none"
      },
      "content": [
        {
          "kind": "record",
          "entity_id": "entity.workorder",
          "record_id_query": "record",
          "content": [
            {
              "kind": "grid",
              "columns": 12,
              "gap": "md",
              "items": [
                {
                  "span": 8,
                  "content": [
                    {
                      "kind": "container",
                      "variant": "card",
                      "content": [
                        {
                          "kind": "view",
                          "target": "view:workorder.form"
                        }
                      ]
                    }
                  ]
                },
                {
                  "span": 4,
                  "content": [
                    {
                      "kind": "container",
                      "variant": "card",
                      "content": [
                        {
                          "kind": "chatter",
                          "entity_id": "entity.workorder",
                          "record_ref": "$record.id"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "workorder_line.form_page",
      "title": "Work Order Line",
      "layout": "single",
      "header": {
        "variant": "none"
      },
      "content": [
        {
          "kind": "record",
          "entity_id": "entity.workorder_line",
          "record_id_query": "record",
          "content": [
            {
              "kind": "container",
              "variant": "card",
              "content": [
                {
                  "kind": "view",
                  "target": "view:workorder_line.form"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "workorder_line.list_page",
      "title": "Work Order Lines",
      "layout": "single",
      "header": {
        "variant": "none",
        "actions": [
          {
            "action_id": "action.refresh"
          },
          {
            "kind": "navigate",
            "label": "New",
            "target": "page:workorder_line.form_page"
          }
        ]
      },
      "content": [
        {
          "kind": "container",
          "variant": "card",
          "content": [
            {
              "kind": "view_modes",
              "entity_id": "entity.workorder_line",
              "default_mode": "list",
              "modes": [
                {
                  "mode": "list",
                  "target": "view:workorder_line.list"
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
