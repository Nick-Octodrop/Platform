{
  "manifest_version": "1.3",
  "module": {
    "id": "workorders",
    "name": "Work Orders",
    "version": "1.0.0",
    "description": "Create, schedule, and track work orders from intake to completion.",
    "category": "Operations",
    "icon_key": "lucide:ClipboardList"
  },
  "app": {
    "home": "page:workorder.list_page",
    "defaults": {
      "entity_home_page": "page:workorder.list_page",
      "entity_form_page": "page:workorder.form_page",
      "entities": {
        "entity.workorder": {
          "entity_home_page": "page:workorder.list_page",
          "entity_form_page": "page:workorder.form_page"
        }
      }
    },
    "nav": [
      {
        "group": "Work Orders",
        "items": [
          {
            "label": "Work Orders",
            "to": "page:workorder.list_page"
          }
        ]
      }
    ]
  },
  "entities": [
    {
      "id": "entity.workorder",
      "display_field": "workorder.number",
      "fields": [
        {
          "id": "workorder.id",
          "type": "uuid",
          "label": "ID",
          "readonly": true
        },
        {
          "id": "workorder.number",
          "type": "string",
          "label": "Work Order #",
          "required": true,
          "help_text": "Unique job reference shown to customers and technicians."
        },
        {
          "id": "workorder.title",
          "type": "string",
          "label": "Title",
          "required": true
        },
        {
          "id": "workorder.status",
          "type": "enum",
          "label": "Status",
          "required": true,
          "default": "new",
          "options": [
            {
              "value": "new",
              "label": "New"
            },
            {
              "value": "scheduled",
              "label": "Scheduled"
            },
            {
              "value": "in_progress",
              "label": "In Progress"
            },
            {
              "value": "on_hold",
              "label": "On Hold"
            },
            {
              "value": "done",
              "label": "Done"
            },
            {
              "value": "cancelled",
              "label": "Cancelled"
            }
          ]
        },
        {
          "id": "workorder.priority",
          "type": "enum",
          "label": "Priority",
          "required": true,
          "default": "normal",
          "options": [
            {
              "value": "low",
              "label": "Low"
            },
            {
              "value": "normal",
              "label": "Normal"
            },
            {
              "value": "high",
              "label": "High"
            },
            {
              "value": "urgent",
              "label": "Urgent"
            }
          ]
        },
        {
          "id": "workorder.type",
          "type": "enum",
          "label": "Work Type",
          "required": true,
          "default": "installation",
          "options": [
            {
              "value": "installation",
              "label": "Installation"
            },
            {
              "value": "repair",
              "label": "Repair"
            },
            {
              "value": "maintenance",
              "label": "Maintenance"
            },
            {
              "value": "inspection",
              "label": "Inspection"
            }
          ]
        },
        {
          "id": "workorder.contact_id",
          "type": "lookup",
          "label": "Customer",
          "entity": "entity.contact",
          "display_field": "contact.display_name",
          "required": true,
          "help_text": "Primary customer contact from Contacts module."
        },
        {
          "id": "workorder.assignee_id",
          "type": "lookup",
          "label": "Assigned Technician",
          "entity": "entity.contact",
          "display_field": "contact.display_name",
          "help_text": "Technician responsible for execution."
        },
        {
          "id": "workorder.scheduled_start",
          "type": "datetime",
          "label": "Scheduled Start"
        },
        {
          "id": "workorder.scheduled_end",
          "type": "datetime",
          "label": "Scheduled End"
        },
        {
          "id": "workorder.completed_at",
          "type": "datetime",
          "label": "Completed At"
        },
        {
          "id": "workorder.site_name",
          "type": "string",
          "label": "Site Name"
        },
        {
          "id": "workorder.site_address",
          "type": "text",
          "label": "Site Address"
        },
        {
          "id": "workorder.city",
          "type": "string",
          "label": "City"
        },
        {
          "id": "workorder.country",
          "type": "string",
          "label": "Country"
        },
        {
          "id": "workorder.labor_hours",
          "type": "number",
          "label": "Labor Hours",
          "default": 0
        },
        {
          "id": "workorder.materials_cost",
          "type": "number",
          "label": "Materials Cost",
          "default": 0
        },
        {
          "id": "workorder.total_cost",
          "type": "number",
          "label": "Total Cost",
          "help_text": "For demo: enter total manually."
        },
        {
          "id": "workorder.description",
          "type": "text",
          "label": "Scope of Work"
        },
        {
          "id": "workorder.internal_notes",
          "type": "text",
          "label": "Internal Notes"
        },
        {
          "id": "workorder.tags",
          "type": "tags",
          "label": "Tags",
          "help_text": "For quick filtering and analytics."
        }
      ]
    }
  ],
  "relations": [
    {
      "from": "workorder.contact_id",
      "to": "contact.id",
      "label_field": "contact.display_name"
    },
    {
      "from": "workorder.assignee_id",
      "to": "contact.id",
      "label_field": "contact.display_name"
    }
  ],
  "workflows": [
    {
      "id": "workorder_status_workflow",
      "entity": "entity.workorder",
      "status_field": "workorder.status",
      "states": [
        {
          "id": "new",
          "label": "New"
        },
        {
          "id": "scheduled",
          "label": "Scheduled"
        },
        {
          "id": "in_progress",
          "label": "In Progress"
        },
        {
          "id": "on_hold",
          "label": "On Hold"
        },
        {
          "id": "done",
          "label": "Done"
        },
        {
          "id": "cancelled",
          "label": "Cancelled"
        }
      ]
    }
  ],
  "actions": [
    {
      "id": "action.refresh",
      "kind": "refresh",
      "label": "Refresh"
    },
    {
      "id": "action.workorder_new",
      "kind": "open_form",
      "target": "workorder.form",
      "label": "New"
    },
    {
      "id": "action.workorder_set_new",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: New",
      "patch": {
        "workorder.status": "new"
      }
    },
    {
      "id": "action.workorder_bulk_set_new",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: New",
      "patch": {
        "workorder.status": "new"
      }
    },
    {
      "id": "action.workorder_set_scheduled",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: Scheduled",
      "patch": {
        "workorder.status": "scheduled"
      }
    },
    {
      "id": "action.workorder_bulk_set_scheduled",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: Scheduled",
      "patch": {
        "workorder.status": "scheduled"
      }
    },
    {
      "id": "action.workorder_set_in_progress",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: In Progress",
      "patch": {
        "workorder.status": "in_progress"
      }
    },
    {
      "id": "action.workorder_bulk_set_in_progress",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: In Progress",
      "patch": {
        "workorder.status": "in_progress"
      }
    },
    {
      "id": "action.workorder_set_on_hold",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: On Hold",
      "patch": {
        "workorder.status": "on_hold"
      }
    },
    {
      "id": "action.workorder_bulk_set_on_hold",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: On Hold",
      "patch": {
        "workorder.status": "on_hold"
      }
    },
    {
      "id": "action.workorder_set_done",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: Done",
      "patch": {
        "workorder.status": "done"
      }
    },
    {
      "id": "action.workorder_bulk_set_done",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: Done",
      "patch": {
        "workorder.status": "done"
      }
    },
    {
      "id": "action.workorder_set_cancelled",
      "kind": "update_record",
      "entity_id": "entity.workorder",
      "label": "Set: Cancelled",
      "patch": {
        "workorder.status": "cancelled"
      }
    },
    {
      "id": "action.workorder_bulk_set_cancelled",
      "kind": "bulk_update",
      "entity_id": "entity.workorder",
      "label": "Set: Cancelled",
      "patch": {
        "workorder.status": "cancelled"
      }
    },
    {
      "id": "action.mark_scheduled",
      "kind": "update_record",
      "label": "Schedule",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "scheduled"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "new"
      }
    },
    {
      "id": "action.start_work",
      "kind": "update_record",
      "label": "Start Work",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "in_progress"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "scheduled"
      }
    },
    {
      "id": "action.put_on_hold",
      "kind": "update_record",
      "label": "Put On Hold",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "on_hold"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "in_progress"
      }
    },
    {
      "id": "action.resume_work",
      "kind": "update_record",
      "label": "Resume Work",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "in_progress"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "on_hold"
      }
    },
    {
      "id": "action.complete_work",
      "kind": "update_record",
      "label": "Complete",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "done"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "in_progress"
      }
    },
    {
      "id": "action.reopen_work",
      "kind": "update_record",
      "label": "Reopen",
      "entity_id": "entity.workorder",
      "patch": {
        "workorder.status": "in_progress"
      },
      "visible_when": {
        "op": "eq",
        "field": "workorder.status",
        "value": "done"
      }
    },
    {
      "id": "action.email_workorder",
      "kind": "refresh",
      "label": "Email Work Order",
      "visible_when": {
        "op": "exists",
        "field": "workorder.number"
      }
    },
    {
      "id": "action.generate_workorder_pdf",
      "kind": "refresh",
      "label": "Generate PDF",
      "visible_when": {
        "op": "exists",
        "field": "workorder.number"
      }
    }
  ],
  "triggers": [
    {
      "id": "workorders.record.created",
      "event": "record.created",
      "entity_id": "entity.workorder"
    },
    {
      "id": "workorders.record.updated",
      "event": "record.updated",
      "entity_id": "entity.workorder"
    },
    {
      "id": "workorders.action.mark_scheduled",
      "event": "action.clicked",
      "action_id": "action.mark_scheduled"
    },
    {
      "id": "workorders.action.start_work",
      "event": "action.clicked",
      "action_id": "action.start_work"
    },
    {
      "id": "workorders.action.put_on_hold",
      "event": "action.clicked",
      "action_id": "action.put_on_hold"
    },
    {
      "id": "workorders.action.resume_work",
      "event": "action.clicked",
      "action_id": "action.resume_work"
    },
    {
      "id": "workorders.action.complete_work",
      "event": "action.clicked",
      "action_id": "action.complete_work"
    },
    {
      "id": "workorders.action.reopen_work",
      "event": "action.clicked",
      "action_id": "action.reopen_work"
    },
    {
      "id": "workorders.action.email_workorder",
      "event": "action.clicked",
      "action_id": "action.email_workorder"
    },
    {
      "id": "workorders.action.generate_workorder_pdf",
      "event": "action.clicked",
      "action_id": "action.generate_workorder_pdf"
    },
    {
      "id": "workorders.workflow.status_changed",
      "event": "workflow.status_changed",
      "entity_id": "entity.workorder",
      "status_field": "workorder.status"
    }
  ],
  "views": [
    {
      "id": "workorder.list",
      "entity": "entity.workorder",
      "kind": "list",
      "columns": [
        {
          "field_id": "workorder.number"
        },
        {
          "field_id": "workorder.title"
        },
        {
          "field_id": "workorder.status"
        },
        {
          "field_id": "workorder.priority"
        },
        {
          "field_id": "workorder.type"
        },
        {
          "field_id": "workorder.contact_id"
        },
        {
          "field_id": "workorder.assignee_id"
        },
        {
          "field_id": "workorder.scheduled_start"
        },
        {
          "field_id": "workorder.total_cost"
        }
      ],
      "open_record": {
        "to": "page:workorder.form_page",
        "param": "record"
      },
      "header": {
        "primary_actions": [
          {
            "action_id": "action.workorder_new"
          }
        ],
        "search": {
          "enabled": true,
          "placeholder": "Search work orders...",
          "fields": [
            "workorder.number",
            "workorder.title",
            "workorder.status",
            "workorder.priority",
            "workorder.type",
            "workorder.site_name",
            "workorder.city",
            "workorder.country"
          ]
        },
        "filters": [
          {
            "id": "all",
            "label": "All",
            "domain": {
              "op": "exists",
              "field": "workorder.number"
            }
          },
          {
            "id": "new",
            "label": "New",
            "domain": {
              "op": "eq",
              "field": "workorder.status",
              "value": "new"
            }
          },
          {
            "id": "in_progress",
            "label": "In Progress",
            "domain": {
              "op": "eq",
              "field": "workorder.status",
              "value": "in_progress"
            }
          },
          {
            "id": "done",
            "label": "Done",
            "domain": {
              "op": "eq",
              "field": "workorder.status",
              "value": "done"
            }
          }
        ]
      },
      "create_behavior": "open_form"
    },
    {
      "id": "workorder.kanban",
      "kind": "kanban",
      "entity": "entity.workorder",
      "card": {
        "title_field": "workorder.number",
        "subtitle_fields": [
          "workorder.title",
          "workorder.contact_id"
        ],
        "badge_fields": [
          "workorder.priority",
          "workorder.status",
          "workorder.tags"
        ]
      }
    },
    {
      "id": "workorder.graph",
      "kind": "graph",
      "entity": "entity.workorder",
      "default": {
        "type": "bar",
        "group_by": "workorder.status",
        "measure": "count"
      }
    },
    {
      "id": "workorder.form",
      "entity": "entity.workorder",
      "kind": "form",
      "activity": {
        "enabled": true,
        "mode": "tab",
        "tab_label": "Activity",
        "allow_comments": true,
        "allow_attachments": true,
        "show_changes": true,
        "tracked_fields": [
          "workorder.status",
          "workorder.assignee_id",
          "workorder.scheduled_start",
          "workorder.scheduled_end"
        ]
      },
      "sections": [
        {
          "id": "main",
          "layout": "columns",
          "columns": 2,
          "fields": [
            "workorder.number",
            "workorder.title",
            "workorder.status",
            "workorder.priority",
            "workorder.type",
            "workorder.contact_id",
            "workorder.assignee_id",
            "workorder.scheduled_start",
            "workorder.scheduled_end",
            "workorder.completed_at",
            "workorder.tags"
          ]
        },
        {
          "id": "site",
          "layout": "columns",
          "columns": 2,
          "fields": [
            "workorder.site_name",
            "workorder.site_address",
            "workorder.city",
            "workorder.country"
          ]
        },
        {
          "id": "costs",
          "layout": "columns",
          "columns": 2,
          "fields": [
            "workorder.labor_hours",
            "workorder.materials_cost",
            "workorder.total_cost"
          ]
        },
        {
          "id": "scope",
          "fields": [
            "workorder.description"
          ]
        },
        {
          "id": "notes",
          "fields": [
            "workorder.internal_notes"
          ]
        }
      ],
      "header": {
        "title_field": "workorder.number",
        "primary_actions": [
          {
            "action_id": "action.mark_scheduled"
          },
          {
            "action_id": "action.start_work"
          },
          {
            "action_id": "action.put_on_hold"
          },
          {
            "action_id": "action.resume_work"
          },
          {
            "action_id": "action.complete_work"
          },
          {
            "action_id": "action.reopen_work"
          },
          {
            "action_id": "action.email_workorder"
          },
          {
            "action_id": "action.generate_workorder_pdf"
          }
        ],
        "secondary_actions": [
          {
            "action_id": "action.refresh"
          }
        ],
        "save_mode": "top",
        "auto_save": true,
        "auto_save_debounce_ms": 750,
        "statusbar": {
          "field_id": "workorder.status"
        },
        "tabs": {
          "style": "lifted",
          "default_tab": "details",
          "tabs": [
            {
              "id": "details",
              "label": "Details",
              "sections": [
                "main"
              ]
            },
            {
              "id": "site",
              "label": "Site",
              "sections": [
                "site"
              ]
            },
            {
              "id": "costs",
              "label": "Costs",
              "sections": [
                "costs"
              ]
            },
            {
              "id": "scope",
              "label": "Scope",
              "sections": [
                "scope"
              ]
            },
            {
              "id": "notes",
              "label": "Notes",
              "sections": [
                "notes"
              ]
            }
          ]
        }
      }
    }
  ],
  "pages": [
    {
      "id": "workorder.list_page",
      "title": "Work Orders",
      "layout": "single",
      "header": {
        "variant": "none",
        "actions": [
          {
            "action_id": "action.refresh"
          },
          {
            "kind": "navigate",
            "label": "New",
            "target": "page:workorder.form_page"
          }
        ]
      },
      "content": [
        {
          "kind": "container",
          "variant": "card",
          "content": [
            {
              "kind": "view_modes",
              "entity_id": "entity.workorder",
              "default_mode": "list",
              "modes": [
                {
                  "mode": "list",
                  "target": "view:workorder.list"
                },
                {
                  "mode": "kanban",
                  "target": "view:workorder.kanban",
                  "default_group_by": "workorder.status"
                },
                {
                  "mode": "graph",
                  "target": "view:workorder.graph"
                },
                {
                  "mode": "pivot",
                  "target": "view:workorder.graph"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "workorder.form_page",
      "title": "Work Order",
      "layout": "single",
      "header": {
        "variant": "none"
      },
      "content": [
        {
          "kind": "record",
          "entity_id": "entity.workorder",
          "record_id_query": "record",
          "content": [
            {
              "kind": "grid",
              "columns": 12,
              "gap": "md",
              "items": [
                {
                  "span": 8,
                  "content": [
                    {
                      "kind": "container",
                      "variant": "card",
                      "content": [
                        {
                          "kind": "view",
                          "target": "view:workorder.form"
                        }
                      ]
                    }
                  ]
                },
                {
                  "span": 4,
                  "content": [
                    {
                      "kind": "container",
                      "variant": "card",
                      "content": [
                        {
                          "kind": "chatter",
                          "entity_id": "entity.workorder",
                          "record_ref": "$record.id"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
